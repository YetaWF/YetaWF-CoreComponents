/* URI.js v1.12.0 http://medialize.github.com/URI.js/ */
(function(a,b){"object"===typeof exports?module.exports=b(require("./punycode"),require("./IPv6"),require("./SecondLevelDomains")):"function"===typeof define&&define.amd?define(["./punycode","./IPv6","./SecondLevelDomains"],b):a.URI=b(a.punycode,a.IPv6,a.SecondLevelDomains,a)})(this,function(E,F,J,N){function i(d,e){if(!(this instanceof i)){return new i(d,e)}void 0===d&&(d="undefined"!==typeof location?location.href+"":"");this.href(d);return void 0!==e?this.absoluteTo(e):this}function K(d){return d.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function O(d){return void 0===d?"Undefined":String(Object.prototype.toString.call(d)).slice(8,-1)}function G(d){return"Array"===O(d)}function P(f,g){var h,k;if(G(g)){h=0;for(k=g.length;h<k;h++){if(!P(f,g[h])){return !1}}return !0}var m=O(g);h=0;for(k=f.length;h<k;h++){if("RegExp"===m){if("string"===typeof f[h]&&f[h].match(g)){return !0}}else{if(f[h]===g){return !0}}}return !1}function Q(e,f){if(!G(e)||!G(f)||e.length!==f.length){return !1}e.sort();f.sort();for(var g=0,h=e.length;g<h;g++){if(e[g]!==f[g]){return !1}}return !0}function R(d){return escape(d)}function v(d){return encodeURIComponent(d).replace(/[!'()*]/g,R).replace(/\*/g,"%2A")}var o=N&&N.URI;i.version="1.12.0";var l=i.prototype,L=Object.prototype.hasOwnProperty;i._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:i.duplicateQueryParameters,escapeQuerySpace:i.escapeQuerySpace}};i.duplicateQueryParameters=!1;i.escapeQuerySpace=!0;i.protocol_expression=/^[a-z][a-z0-9.+-]*$/i;i.idn_expression=/[^a-z0-9\.-]/i;i.punycode_expression=/(xn--)/i;i.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/;i.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/;i.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u2018\u2019]))/ig;i.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u201e\u2018\u2019]+$/};i.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"};i.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/;i.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src"};i.getDomAttribute=function(d){if(d&&d.nodeName){var e=d.nodeName.toLowerCase();return"input"===e&&"image"!==d.type?void 0:i.domAttributes[e]}};i.encode=v;i.decode=decodeURIComponent;i.iso8859=function(){i.encode=escape;i.decode=unescape};i.unicode=function(){i.encode=v;i.decode=decodeURIComponent};i.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}}};i.encodeQuery=function(d,e){var f=i.encode(d+"");return e?f.replace(/%20/g,"+"):f};i.decodeQuery=function(d,e){d+="";try{return i.decode(e?d.replace(/\+/g,"%20"):d)}catch(f){return d}};i.recodePath=function(d){d=(d+"").split("/");for(var e=0,f=d.length;e<f;e++){d[e]=i.encodePathSegment(i.decode(d[e]))}return d.join("/")};i.decodePath=function(d){d=(d+"").split("/");for(var e=0,f=d.length;e<f;e++){d[e]=i.decodePathSegment(d[e])}return d.join("/")};var H={encode:"encode",decode:"decode"},I,M=function(d,e){return function(f){return i[e](f+"").replace(i.characters[d][e].expression,function(g){return i.characters[d][e].map[g]})}};for(I in H){i[I+"PathSegment"]=M("pathname",H[I])}i.encodeReserved=M("reserved","encode");i.parse=function(d,e){var f;e||(e={});f=d.indexOf("#");-1<f&&(e.fragment=d.substring(f+1)||null,d=d.substring(0,f));f=d.indexOf("?");-1<f&&(e.query=d.substring(f+1)||null,d=d.substring(0,f));"//"===d.substring(0,2)?(e.protocol=null,d=d.substring(2),d=i.parseAuthority(d,e)):(f=d.indexOf(":"),-1<f&&(e.protocol=d.substring(0,f)||null,e.protocol&&!e.protocol.match(i.protocol_expression)?e.protocol=void 0:"file"===e.protocol?d=d.substring(f+3):"//"===d.substring(f+1,f+3)?(d=d.substring(f+3),d=i.parseAuthority(d,e)):(d=d.substring(f+1),e.urn=!0)));e.path=d;return e};i.parseHost=function(e,f){var g=e.indexOf("/"),h;-1===g&&(g=e.length);"["===e.charAt(0)?(h=e.indexOf("]"),f.hostname=e.substring(1,h)||null,f.port=e.substring(h+2,g)||null):e.indexOf(":")!==e.lastIndexOf(":")?(f.hostname=e.substring(0,g)||null,f.port=null):(h=e.substring(0,g).split(":"),f.hostname=h[0]||null,f.port=h[1]||null);f.hostname&&"/"!==e.substring(g).charAt(0)&&(g++,e="/"+e);return e.substring(g)||"/"};i.parseAuthority=function(d,e){d=i.parseUserinfo(d,e);return i.parseHost(d,e)};i.parseUserinfo=function(d,e){var f=d.indexOf("/"),g=-1<f?d.lastIndexOf("@",f):d.indexOf("@");-1<g&&(-1===f||g<f)?(f=d.substring(0,g).split(":"),e.username=f[0]?i.decode(f[0]):null,f.shift(),e.password=f[0]?i.decode(f.join(":")):null,d=d.substring(g+1)):(e.username=null,e.password=null);return d};i.parseQuery=function(d,h){if(!d){return{}}d=d.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"");if(!d){return{}}for(var k={},q=d.split("&"),m=q.length,r,p,n=0;n<m;n++){r=q[n].split("="),p=i.decodeQuery(r.shift(),h),r=r.length?i.decodeQuery(r.join("="),h):null,k[p]?("string"===typeof k[p]&&(k[p]=[k[p]]),k[p].push(r)):k[p]=r}return k};i.build=function(d){var e="";d.protocol&&(e+=d.protocol+":");d.urn||!e&&!d.hostname||(e+="//");e+=i.buildAuthority(d)||"";"string"===typeof d.path&&("/"!==d.path.charAt(0)&&"string"===typeof d.hostname&&(e+="/"),e+=d.path);"string"===typeof d.query&&d.query&&(e+="?"+d.query);"string"===typeof d.fragment&&d.fragment&&(e+="#"+d.fragment);return e};i.buildHost=function(d){var e="";if(d.hostname){i.ip6_expression.test(d.hostname)?e=d.port?e+("["+d.hostname+"]:"+d.port):e+d.hostname:(e+=d.hostname,d.port&&(e+=":"+d.port))}else{return""}return e};i.buildAuthority=function(d){return i.buildUserinfo(d)+i.buildHost(d)};i.buildUserinfo=function(d){var e="";d.username&&(e+=i.encode(d.username),d.password&&(e+=":"+i.encode(d.password)),e+="@");return e};i.buildQuery=function(d,k,m){var s="",n,q,p,r;for(q in d){if(L.call(d,q)&&q){if(G(d[q])){for(n={},p=0,r=d[q].length;p<r;p++){void 0!==d[q][p]&&void 0===n[d[q][p]+""]&&(s+="&"+i.buildQueryParameter(q,d[q][p],m),!0!==k&&(n[d[q][p]+""]=!0))}}else{void 0!==d[q]&&(s+="&"+i.buildQueryParameter(q,d[q],m))}}}return s.substring(1)};i.buildQueryParameter=function(d,e,f){return i.encodeQuery(d,f)+(null!==e?"="+i.encodeQuery(e,f):"")};i.addQuery=function(d,e,f){if("object"===typeof e){for(var g in e){L.call(e,g)&&i.addQuery(d,g,e[g])}}else{if("string"===typeof e){void 0===d[e]?d[e]=f:("string"===typeof d[e]&&(d[e]=[d[e]]),G(f)||(f=[f]),d[e]=d[e].concat(f))}else{throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")}}};i.removeQuery=function(d,h,k){var q;if(G(h)){for(k=0,q=h.length;k<q;k++){d[h[k]]=void 0}}else{if("object"===typeof h){for(q in h){L.call(h,q)&&i.removeQuery(d,q,h[q])}}else{if("string"===typeof h){if(void 0!==k){if(d[h]===k){d[h]=void 0}else{if(G(d[h])){q=d[h];var m={},p,n;if(G(k)){for(p=0,n=k.length;p<n;p++){m[k[p]]=!0}}else{m[k]=!0}p=0;for(n=q.length;p<n;p++){void 0!==m[q[p]]&&(q.splice(p,1),n--,p--)}d[h]=q}}}else{d[h]=void 0}}else{throw new TypeError("URI.addQuery() accepts an object, string as the first parameter")}}}};i.hasQuery=function(d,f,g,k){if("object"===typeof f){for(var h in f){if(L.call(f,h)&&!i.hasQuery(d,h,f[h])){return !1}}return !0}if("string"!==typeof f){throw new TypeError("URI.hasQuery() accepts an object, string as the name parameter")}switch(O(g)){case"Undefined":return f in d;case"Boolean":return d=Boolean(G(d[f])?d[f].length:d[f]),g===d;case"Function":return !!g(d[f],f,d);case"Array":return G(d[f])?(k?P:Q)(d[f],g):!1;case"RegExp":return G(d[f])?k?P(d[f],g):!1:Boolean(d[f]&&d[f].match(g));case"Number":g=String(g);case"String":return G(d[f])?k?P(d[f],g):!1:d[f]===g;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}};i.commonPath=function(e,f){var g=Math.min(e.length,f.length),h;for(h=0;h<g;h++){if(e.charAt(h)!==f.charAt(h)){h--;break}}if(1>h){return e.charAt(0)===f.charAt(0)&&"/"===e.charAt(0)?"/":""}if("/"!==e.charAt(h)||"/"!==f.charAt(h)){h=e.substring(0,h).lastIndexOf("/")}return e.substring(0,h+1)};i.withinString=function(d,n,p){p||(p={});var w=p.start||i.findUri.start,q=p.end||i.findUri.end,s=p.trim||i.findUri.trim,r=/[a-z0-9-]=["']?$/i;for(w.lastIndex=0;;){var t=w.exec(d);if(!t){break}t=t.index;if(p.ignoreHtml){var u=d.slice(Math.max(t-3,0),t);if(u&&r.test(u)){continue}}var u=t+d.slice(t).search(q),x=d.slice(t,u).replace(s,"");p.ignore&&p.ignore.test(x)||(u=t+x.length,x=n(x,t,u,d),d=d.slice(0,t)+x+d.slice(u),w.lastIndex=t+x.length)}w.lastIndex=0;return d};i.ensureValidHostname=function(d){if(d.match(i.invalid_hostname_characters)){if(!E){throw new TypeError("Hostname '"+d+"' contains characters other than [A-Z0-9.-] and Punycode.js is not available")}if(E.toASCII(d).match(i.invalid_hostname_characters)){throw new TypeError("Hostname '"+d+"' contains characters other than [A-Z0-9.-]")}}};i.noConflict=function(d){if(d){return d={URI:this.noConflict()},URITemplate&&"function"==typeof URITemplate.noConflict&&(d.URITemplate=URITemplate.noConflict()),F&&"function"==typeof F.noConflict&&(d.IPv6=F.noConflict()),SecondLevelDomains&&"function"==typeof SecondLevelDomains.noConflict&&(d.SecondLevelDomains=SecondLevelDomains.noConflict()),d}N.URI===this&&(N.URI=o);return this};l.build=function(d){if(!0===d){this._deferred_build=!0}else{if(void 0===d||this._deferred_build){this._string=i.build(this._parts),this._deferred_build=!1}}return this};l.clone=function(){return new i(this)};l.valueOf=l.toString=function(){return this.build(!1)._string};H={protocol:"protocol",username:"username",password:"password",hostname:"hostname",port:"port"};M=function(d){return function(e,f){if(void 0===e){return this._parts[d]||""}this._parts[d]=e||null;this.build(!f);return this}};for(I in H){l[I]=M(H[I])}H={query:"?",fragment:"#"};M=function(d,e){return function(f,g){if(void 0===f){return this._parts[d]||""}null!==f&&(f+="",f.charAt(0)===e&&(f=f.substring(1)));this._parts[d]=f;this.build(!g);return this}};for(I in H){l[I]=M(I,H[I])}H={search:["?","query"],hash:["#","fragment"]};M=function(d,e){return function(f,g){var h=this[d](f,g);return"string"===typeof h&&h.length?e+h:h}};for(I in H){l[I]=M(H[I][1],H[I][0])}l.pathname=function(d,e){if(void 0===d||!0===d){var f=this._parts.path||(this._parts.hostname?"/":"");return d?i.decodePath(f):f}this._parts.path=d?i.recodePath(d):"/";this.build(!e);return this};l.path=l.pathname;l.href=function(d,f){var h;if(void 0===d){return this.toString()}this._string="";this._parts=i._parts();var k=d instanceof i,m="object"===typeof d&&(d.hostname||d.path||d.pathname);d.nodeName&&(m=i.getDomAttribute(d),d=d[m]||"",m=!1);!k&&m&&void 0!==d.pathname&&(d=d.toString());if("string"===typeof d){this._parts=i.parse(d,this._parts)}else{if(k||m){for(h in k=k?d._parts:d,k){L.call(this._parts,h)&&(this._parts[h]=k[h])}}else{throw new TypeError("invalid input")}}this.build(!f);return this};l.is=function(d){var n=!1,p=!1,q=!1,s=!1,r=!1,t=!1,u=!1,w=!this._parts.urn;this._parts.hostname&&(w=!1,p=i.ip4_expression.test(this._parts.hostname),q=i.ip6_expression.test(this._parts.hostname),n=p||q,r=(s=!n)&&J&&J.has(this._parts.hostname),t=s&&i.idn_expression.test(this._parts.hostname),u=s&&i.punycode_expression.test(this._parts.hostname));switch(d.toLowerCase()){case"relative":return w;case"absolute":return !w;case"domain":case"name":return s;case"sld":return r;case"ip":return n;case"ip4":case"ipv4":case"inet4":return p;case"ip6":case"ipv6":case"inet6":return q;case"idn":return t;case"url":return !this._parts.urn;case"urn":return !!this._parts.urn;case"punycode":return u}return null};var a=l.protocol,b=l.port,c=l.hostname;l.protocol=function(d,e){if(void 0!==d&&d&&(d=d.replace(/:(\/\/)?$/,""),!d.match(i.protocol_expression))){throw new TypeError("Protocol '"+d+"' contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]")}return a.call(this,d,e)};l.scheme=l.protocol;l.port=function(d,e){if(this._parts.urn){return void 0===d?"":this}if(void 0!==d&&(0===d&&(d=null),d&&(d+="",":"===d.charAt(0)&&(d=d.substring(1)),d.match(/[^0-9]/)))){throw new TypeError("Port '"+d+"' contains characters other than [0-9]")}return b.call(this,d,e)};l.hostname=function(d,e){if(this._parts.urn){return void 0===d?"":this}if(void 0!==d){var f={};i.parseHost(d,f);d=f.hostname}return c.call(this,d,e)};l.host=function(d,e){if(this._parts.urn){return void 0===d?"":this}if(void 0===d){return this._parts.hostname?i.buildHost(this._parts):""}i.parseHost(d,this._parts);this.build(!e);return this};l.authority=function(d,e){if(this._parts.urn){return void 0===d?"":this}if(void 0===d){return this._parts.hostname?i.buildAuthority(this._parts):""}i.parseAuthority(d,this._parts);this.build(!e);return this};l.userinfo=function(d,e){if(this._parts.urn){return void 0===d?"":this}if(void 0===d){if(!this._parts.username){return""}var f=i.buildUserinfo(this._parts);return f.substring(0,f.length-1)}"@"!==d[d.length-1]&&(d+="@");i.parseUserinfo(d,this._parts);this.build(!e);return this};l.resource=function(d,e){var f;if(void 0===d){return this.path()+this.search()+this.hash()}f=i.parse(d);this._parts.path=f.path;this._parts.query=f.query;this._parts.fragment=f.fragment;this.build(!e);return this};l.subdomain=function(d,e){if(this._parts.urn){return void 0===d?"":this}if(void 0===d){if(!this._parts.hostname||this.is("IP")){return""}var f=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,f)||""}f=this._parts.hostname.length-this.domain().length;f=this._parts.hostname.substring(0,f);f=RegExp("^"+K(f));d&&"."!==d.charAt(d.length-1)&&(d+=".");d&&i.ensureValidHostname(d);this._parts.hostname=this._parts.hostname.replace(f,d);this.build(!e);return this};l.domain=function(d,e){if(this._parts.urn){return void 0===d?"":this}"boolean"===typeof d&&(e=d,d=void 0);if(void 0===d){if(!this._parts.hostname||this.is("IP")){return""}var f=this._parts.hostname.match(/\./g);if(f&&2>f.length){return this._parts.hostname}f=this._parts.hostname.length-this.tld(e).length-1;f=this._parts.hostname.lastIndexOf(".",f-1)+1;return this._parts.hostname.substring(f)||""}if(!d){throw new TypeError("cannot set domain empty")}i.ensureValidHostname(d);!this._parts.hostname||this.is("IP")?this._parts.hostname=d:(f=RegExp(K(this.domain())+"$"),this._parts.hostname=this._parts.hostname.replace(f,d));this.build(!e);return this};l.tld=function(d,e){if(this._parts.urn){return void 0===d?"":this}"boolean"===typeof d&&(e=d,d=void 0);if(void 0===d){if(!this._parts.hostname||this.is("IP")){return""}var f=this._parts.hostname.lastIndexOf("."),f=this._parts.hostname.substring(f+1);return !0!==e&&J&&J.list[f.toLowerCase()]?J.get(this._parts.hostname)||f:f}if(d){if(d.match(/[^a-zA-Z0-9-]/)){if(J&&J.is(d)){f=RegExp(K(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(f,d)}else{throw new TypeError("TLD '"+d+"' contains characters other than [A-Z0-9]")}}else{if(!this._parts.hostname||this.is("IP")){throw new ReferenceError("cannot set TLD on non-domain host")}f=RegExp(K(this.tld())+"$");this._parts.hostname=this._parts.hostname.replace(f,d)}}else{throw new TypeError("cannot set TLD empty")}this.build(!e);return this};l.directory=function(d,e){if(this._parts.urn){return void 0===d?"":this}if(void 0===d||!0===d){if(!this._parts.path&&!this._parts.hostname){return""}if("/"===this._parts.path){return"/"}var f=this._parts.path.length-this.filename().length-1,f=this._parts.path.substring(0,f)||(this._parts.hostname?"/":"");return d?i.decodePath(f):f}f=this._parts.path.length-this.filename().length;f=this._parts.path.substring(0,f);f=RegExp("^"+K(f));this.is("relative")||(d||(d="/"),"/"!==d.charAt(0)&&(d="/"+d));d&&"/"!==d.charAt(d.length-1)&&(d+="/");d=i.recodePath(d);this._parts.path=this._parts.path.replace(f,d);this.build(!e);return this};l.filename=function(d,f){if(this._parts.urn){return void 0===d?"":this}if(void 0===d||!0===d){if(!this._parts.path||"/"===this._parts.path){return""}var g=this._parts.path.lastIndexOf("/"),g=this._parts.path.substring(g+1);return d?i.decodePathSegment(g):g}g=!1;"/"===d.charAt(0)&&(d=d.substring(1));d.match(/\.?\//)&&(g=!0);var h=RegExp(K(this.filename())+"$");d=i.recodePath(d);this._parts.path=this._parts.path.replace(h,d);g?this.normalizePath(f):this.build(!f);return this};l.suffix=function(d,f){if(this._parts.urn){return void 0===d?"":this}if(void 0===d||!0===d){if(!this._parts.path||"/"===this._parts.path){return""}var g=this.filename(),h=g.lastIndexOf(".");if(-1===h){return""}g=g.substring(h+1);g=/^[a-z0-9%]+$/i.test(g)?g:"";return d?i.decodePathSegment(g):g}"."===d.charAt(0)&&(d=d.substring(1));if(g=this.suffix()){h=d?RegExp(K(g)+"$"):RegExp(K("."+g)+"$")}else{if(!d){return this}this._parts.path+="."+i.recodePath(d)}h&&(d=i.recodePath(d),this._parts.path=this._parts.path.replace(h,d));this.build(!f);return this};l.segment=function(h,k,m){var n=this._parts.urn?":":"/",p=this.path(),r="/"===p.substring(0,1),p=p.split(n);void 0!==h&&"number"!==typeof h&&(m=k,k=h,h=void 0);if(void 0!==h&&"number"!==typeof h){throw Error("Bad segment '"+h+"', must be 0-based integer")}r&&p.shift();0>h&&(h=Math.max(p.length+h,0));if(void 0===k){return void 0===h?p:p[h]}if(null===h||void 0===p[h]){if(G(k)){p=[];h=0;for(var q=k.length;h<q;h++){if(k[h].length||p.length&&p[p.length-1].length){p.length&&!p[p.length-1].length&&p.pop(),p.push(k[h])}}}else{if(k||"string"===typeof k){""===p[p.length-1]?p[p.length-1]=k:p.push(k)}}}else{k||"string"===typeof k&&k.length?p[h]=k:p.splice(h,1)}r&&p.unshift("");return this.path(p.join(n),m)};l.segmentCoded=function(d,f,h){var k,m;"number"!==typeof d&&(h=f,f=d,d=void 0);if(void 0===f){d=this.segment(d,f,h);if(G(d)){for(k=0,m=d.length;k<m;k++){d[k]=i.decode(d[k])}}else{d=void 0!==d?i.decode(d):void 0}return d}if(G(f)){for(k=0,m=f.length;k<m;k++){f[k]=i.decode(f[k])}}else{f="string"===typeof f?i.encode(f):f}return this.segment(d,f,h)};var j=l.query;l.query=function(d,f){if(!0===d){return i.parseQuery(this._parts.query,this._parts.escapeQuerySpace)}if("function"===typeof d){var g=i.parseQuery(this._parts.query,this._parts.escapeQuerySpace),h=d.call(this,g);this._parts.query=i.buildQuery(h||g,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);this.build(!f);return this}return void 0!==d&&"string"!==typeof d?(this._parts.query=i.buildQuery(d,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!f),this):j.call(this,d,f)};l.setQuery=function(d,f,h){var k=i.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("object"===typeof d){for(var m in d){L.call(d,m)&&(k[m]=d[m])}}else{if("string"===typeof d){k[d]=void 0!==f?f:null}else{throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")}}this._parts.query=i.buildQuery(k,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);"string"!==typeof d&&(h=f);this.build(!h);return this};l.addQuery=function(d,f,g){var h=i.parseQuery(this._parts.query,this._parts.escapeQuerySpace);i.addQuery(h,d,void 0===f?null:f);this._parts.query=i.buildQuery(h,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);"string"!==typeof d&&(g=f);this.build(!g);return this};l.removeQuery=function(d,f,g){var h=i.parseQuery(this._parts.query,this._parts.escapeQuerySpace);i.removeQuery(h,d,f);this._parts.query=i.buildQuery(h,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);"string"!==typeof d&&(g=f);this.build(!g);return this};l.hasQuery=function(d,f,g){var h=i.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return i.hasQuery(h,d,f,g)};l.setSearch=l.setQuery;l.addSearch=l.addQuery;l.removeSearch=l.removeQuery;l.hasSearch=l.hasQuery;l.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()};l.normalizeProtocol=function(d){"string"===typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!d));return this};l.normalizeHostname=function(d){this._parts.hostname&&(this.is("IDN")&&E?this._parts.hostname=E.toASCII(this._parts.hostname):this.is("IPv6")&&F&&(this._parts.hostname=F.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!d));return this};l.normalizePort=function(d){"string"===typeof this._parts.protocol&&this._parts.port===i.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!d));return this};l.normalizePath=function(d){if(this._parts.urn||!this._parts.path||"/"===this._parts.path){return this}var h,k=this._parts.path,m="",p,n;"/"!==k.charAt(0)&&(h=!0,k="/"+k);k=k.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/");h&&(m=k.substring(1).match(/^(\.\.\/)+/)||"")&&(m=m[0]);for(;;){p=k.indexOf("/..");if(-1===p){break}else{if(0===p){k=k.substring(3);continue}}n=k.substring(0,p).lastIndexOf("/");-1===n&&(n=p);k=k.substring(0,n)+k.substring(p+3)}h&&this.is("relative")&&(k=m+k.substring(1));k=i.recodePath(k);this._parts.path=k;this.build(!d);return this};l.normalizePathname=l.normalizePath;l.normalizeQuery=function(d){"string"===typeof this._parts.query&&(this._parts.query.length?this.query(i.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!d));return this};l.normalizeFragment=function(d){this._parts.fragment||(this._parts.fragment=null,this.build(!d));return this};l.normalizeSearch=l.normalizeQuery;l.normalizeHash=l.normalizeFragment;l.iso8859=function(){var d=i.encode,e=i.decode;i.encode=escape;i.decode=decodeURIComponent;this.normalize();i.encode=d;i.decode=e;return this};l.unicode=function(){var d=i.encode,e=i.decode;i.encode=v;i.decode=unescape;this.normalize();i.encode=d;i.decode=e;return this};l.readable=function(){var d=this.clone();d.username("").password("").normalize();var h="";d._parts.protocol&&(h+=d._parts.protocol+"://");d._parts.hostname&&(d.is("punycode")&&E?(h+=E.toUnicode(d._parts.hostname),d._parts.port&&(h+=":"+d._parts.port)):h+=d.host());d._parts.hostname&&d._parts.path&&"/"!==d._parts.path.charAt(0)&&(h+="/");h+=d.path(!0);if(d._parts.query){for(var m="",n=0,q=d._parts.query.split("&"),p=q.length;n<p;n++){var r=(q[n]||"").split("="),m=m+("&"+i.decodeQuery(r[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"));void 0!==r[1]&&(m+="="+i.decodeQuery(r[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}h+="?"+m.substring(1)}return h+=i.decodeQuery(d.hash(),!0)};l.absoluteTo=function(d){var f=this.clone(),h=["protocol","username","password","hostname","port"],k,m;if(this._parts.urn){throw Error("URNs do not have any generally defined hierarchical components")}d instanceof i||(d=new i(d));f._parts.protocol||(f._parts.protocol=d._parts.protocol);if(this._parts.hostname){return f}for(k=0;m=h[k];k++){f._parts[m]=d._parts[m]}f._parts.path?".."===f._parts.path.substring(-2)&&(f._parts.path+="/"):(f._parts.path=d._parts.path,f._parts.query||(f._parts.query=d._parts.query));"/"!==f.path().charAt(0)&&(d=d.directory(),f._parts.path=(d?d+"/":"")+f._parts.path,f.normalizePath());f.build();return f};l.relativeTo=function(d){var h=this.clone().normalize(),k,m,p,n;if(h._parts.urn){throw Error("URNs do not have any generally defined hierarchical components")}d=(new i(d)).normalize();k=h._parts;m=d._parts;p=h.path();n=d.path();if("/"!==p.charAt(0)){throw Error("URI is already relative")}if("/"!==n.charAt(0)){throw Error("Cannot calculate a URI relative to another relative URI")}k.protocol===m.protocol&&(k.protocol=null);if(k.username===m.username&&k.password===m.password&&null===k.protocol&&null===k.username&&null===k.password&&k.hostname===m.hostname&&k.port===m.port){k.hostname=null,k.port=null}else{return h.build()}if(p===n){return k.path="",h.build()}d=i.commonPath(h.path(),d.path());if(!d){return h.build()}m=m.path.substring(d.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");k.path=m+k.path.substring(d.length);return h.build()};l.equals=function(d){var h=this.clone();d=new i(d);var k={},m={},p={},n;h.normalize();d.normalize();if(h.toString()===d.toString()){return !0}k=h.query();m=d.query();h.query("");d.query("");if(h.toString()!==d.toString()||k.length!==m.length){return !1}k=i.parseQuery(k,this._parts.escapeQuerySpace);m=i.parseQuery(m,this._parts.escapeQuerySpace);for(n in k){if(L.call(k,n)){if(!G(k[n])){if(k[n]!==m[n]){return !1}}else{if(!Q(k[n],m[n])){return !1}}p[n]=!0}}for(n in m){if(L.call(m,n)&&!p[n]){return !1}}return !0};l.duplicateQueryParameters=function(d){this._parts.duplicateQueryParameters=!!d;return this};l.escapeQuerySpace=function(d){this._parts.escapeQuerySpace=!!d;return this};return i});(function(a,b){"object"===typeof exports?module.exports=b(require("jquery","./URI")):"function"===typeof define&&define.amd?define(["jquery","./URI"],b):b(a.jQuery,a.URI)})(this,function(b,c){function f(h){return h.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function i(h){var k=h.nodeName.toLowerCase();return"input"===k&&"image"!==h.type?void 0:c.domAttributes[k]}function a(h){return{get:function(d){return b(d).uri()[h]()},set:function(k,d){b(k).uri()[h](d);return d}}}function g(h,p){var m,q,r;if(!i(h)||!p){return !1}m=p.match(o);if(!m||!m[5]&&":"!==m[2]&&!e[m[2]]){return !1}r=b(h).uri();if(m[5]){return r.is(m[5])}if(":"===m[2]){return q=m[1].toLowerCase()+":",e[q]?e[q](r,m[4]):!1}q=m[1].toLowerCase();return j[q]?e[m[2]](r[q](),m[4],q):!1}var j={},e={"=":function(h,k){return h===k},"^=":function(h,m,k){return !!(h+"").match(RegExp("^"+f(m),"i"))},"$=":function(h,m,k){return !!(h+"").match(RegExp(f(m)+"$","i"))},"*=":function(h,m,k){"directory"==k&&(h+="/");return !!(h+"").match(RegExp(f(m),"i"))},"equals:":function(h,k){return h.equals(k)},"is:":function(h,k){return h.is(k)}};b.each("authority directory domain filename fragment hash host hostname href password path pathname port protocol query resource scheme search subdomain suffix tld username".split(" "),function(h,d){j[d]=!0;b.attrHooks["uri:"+d]=a(d)});var l=function(h,k){return b(h).uri().href(k).toString()};b.each(["src","href","action","uri","cite"],function(h,k){b.attrHooks[k]={set:l}});b.attrHooks.uri.get=function(h){return b(h).uri()};b.fn.uri=function(k){var q=this.first(),p=q.get(0),r=i(p);if(!r){throw Error('Element "'+p.nodeName+'" does not have either property: href, src, action, cite')}if(void 0!==k){var s=q.data("uri");if(s){return s.href(k)}k instanceof c||(k=c(k||""))}else{if(k=q.data("uri")){return k}k=c(q.attr(r)||"")}k._dom_element=p;k._dom_attribute=r;k.normalize();q.data("uri",k);return k};c.prototype.build=function(h){if(this._dom_element){this._string=c.build(this._parts),this._deferred_build=!1,this._dom_element.setAttribute(this._dom_attribute,this._string),this._dom_element[this._dom_attribute]=this._string}else{if(!0===h){this._deferred_build=!0}else{if(void 0===h||this._deferred_build){this._string=c.build(this._parts),this._deferred_build=!1}}}return this};var n,o=/^([a-zA-Z]+)\s*([\^\$*]?=|:)\s*(['"]?)(.+)\3|^\s*([a-zA-Z0-9]+)\s*$/;n=b.expr.createPseudo?b.expr.createPseudo(function(h){return function(d){return g(d,h)}}):function(h,m,k){return g(h,k[3])};b.expr[":"].uri=n;return{}});