{"version":3,"sources":["Addons/YetaWF/Core/_Addons/Popups/Popups.ts"],"names":[],"mappings":"AAOA;;GAEG;AACH,OAAO,CAAC,IAAI,iBAAiB,EAAE,MAAM,CAAC,WAAW,CAAC;AAElD;;GAEG;AACH,kBAAU,MAAM,CAAC;IAEb,UAAiB,WAAW;QAExB;;WAEG;QACH,UAAU,CAAC,WAAW,CAAC,EAAE,OAAO,GAAI,IAAI,CAAC;QAEzC;;WAEG;QACH,eAAe,IAAI,IAAI,CAAC;QAExB;;WAEG;QACH,gBAAgB,CAAC,MAAM,EAAE,aAAa,EAAE,IAAI,EAAE,CAAC,MAAM,EAAE,WAAW,KAAK,IAAI,GAAG,IAAI,CAAC;QAEnF;;WAEG;QACH,eAAe,CAAC,GAAG,EAAE,MAAM,GAAG,IAAI,CAAC;KACtC;IAED,UAAiB,SAAS;QACtB,MAAM,EAAE,eAAe,CAAC;KAC3B;IACD,UAAiB,eAAe;QAC5B,WAAW,EAAE,OAAO,CAAC;KACxB;IAED,UAAiB,QAAQ;QACrB,MAAM,EAAE,cAAc,CAAC;KAC1B;IACD,UAAiB,cAAc;QAC3B,iBAAiB,EAAE,MAAM,CAAC;QAC1B,kBAAkB,EAAE,MAAM,CAAC;KAC9B;IAED,MAAa,MAAM;QAMf;;WAEG;QACI,UAAU,CAAC,WAAW,CAAC,EAAE,OAAO,GAAG,IAAI;QAI9C;;WAEG;QACI,eAAe,IAAI,IAAI;QAQ9B;;WAEG;QACI,SAAS,CAAC,GAAG,EAAE,MAAM,EAAE,WAAW,EAAE,OAAO,GAAG,OAAO;QAsB5D;;WAEG;QACI,eAAe,CAAC,IAAI,EAAE,iBAAiB,GAAG,OAAO;QA4BxD;;WAEG;QACI,iBAAiB,CAAC,IAAI,EAAE,iBAAiB,GAAG,OAAO;QAWnD,IAAI,IAAI,IAAI;KACtB;CAGJ","file":"Popups.d.ts","sourcesContent":["/* Copyright Â© 2019 Softel vdm, Inc. - https://yetawf.com/Documentation/YetaWF/Licensing */\r\n\r\n/* TODO : While transitioning to TypeScript and to maintain compatibility with all plain JavaScript, these defs are all global rather than in their own namespace.\r\n   Once the transition is complete, we need to revisit this */\r\n\r\n/* Popups API, to be implemented by rendering-specific code - rendering code must define a YetaWF_PopupsImpl object implementing IPopupsImpl */\r\n\r\n/**\r\n * Implemented by custom rendering.\r\n */\r\ndeclare var YetaWF_PopupsImpl: YetaWF.IPopupsImpl;\r\n\r\n/**\r\n * Class implementing popup services used throughout YetaWF.\r\n */\r\nnamespace YetaWF {\r\n\r\n    export interface IPopupsImpl {\r\n\r\n        /**\r\n         * Close the popup - this can only be used by code that is running within the popup (not the parent document/page)\r\n         */\r\n        closePopup(forceReload?: boolean) : void;\r\n\r\n        /**\r\n         * Close the popup - this can only be used by code that is running on the main page (not within the popup)\r\n         */\r\n        closeInnerPopup(): void;\r\n\r\n        /**\r\n         * Opens a dynamic popup, usually a div added to the current document.\r\n         */\r\n        openDynamicPopup(result: ContentResult, done: (dialog: HTMLElement) => void): void;\r\n\r\n        /**\r\n         * Open a static popup, usually a popup based on iframe.\r\n         */\r\n        openStaticPopup(url: string): void;\r\n    }\r\n\r\n    export interface IVolatile {\r\n        Popups: IVolatilePopups;\r\n    }\r\n    export interface IVolatilePopups {\r\n        AllowPopups: boolean;\r\n    }\r\n\r\n    export interface IConfigs {\r\n        Popups: IConfigsPopups;\r\n    }\r\n    export interface IConfigsPopups {\r\n        DefaultPopupWidth: number;\r\n        DefaultPopupHeight: number;\r\n    }\r\n\r\n    export class Popups {\r\n\r\n        // Implemented by renderer\r\n        // Implemented by renderer\r\n        // Implemented by renderer\r\n\r\n        /**\r\n         * Close the popup - this can only be used by code that is running within the popup (not the parent document/page)\r\n         */\r\n        public closePopup(forceReload?: boolean): void {\r\n            YetaWF_PopupsImpl.closePopup(forceReload);\r\n        }\r\n\r\n        /**\r\n         * Close the popup - this can only be used by code that is running on the main page (not within the popup)\r\n         */\r\n        public closeInnerPopup(): void {\r\n            YetaWF_PopupsImpl.closeInnerPopup();\r\n        }\r\n\r\n        // Implemented by YetaWF\r\n        // Implemented by YetaWF\r\n        // Implemented by YetaWF\r\n\r\n        /**\r\n         * opens a popup given a url\r\n         */\r\n        public openPopup(url: string, forceIframe: boolean): boolean {\r\n\r\n            $YetaWF.setLoading(true);\r\n\r\n            // build a url that has a random portion so the page is not cached - this is so we can have the same page nested within itself\r\n            if (url.indexOf(\"?\") < 0)\r\n                url += \"?\";\r\n            else\r\n                url += \"&\";\r\n            url += new Date().getUTCMilliseconds();\r\n            url += \"&\" + YConfigs.Basics.Link_ToPopup + \"=y\";// we're now going into a popup\r\n\r\n            if (!forceIframe) {\r\n                if ($YetaWF.ContentHandling.setContent($YetaWF.parseUrl(url), false, YetaWF_PopupsImpl.openDynamicPopup)) {\r\n                    // contents set in dynamic popup\r\n                    return true;\r\n                }\r\n            }\r\n            YetaWF_PopupsImpl.openStaticPopup(url);\r\n            return true;\r\n        }\r\n\r\n        /**\r\n         * Handles links that invoke a popup window.\r\n         */\r\n        public handlePopupLink(elem: HTMLAnchorElement): boolean {\r\n\r\n            var url = elem.href;\r\n\r\n            // check if this is a popup link\r\n            if (!$YetaWF.elementHasClass(elem, YConfigs.Basics.CssPopupLink))\r\n                return false;\r\n            // check whether we allow popups at all\r\n            if (!YVolatile.Popups.AllowPopups)\r\n                return false;\r\n            if (YVolatile.Skin.MinWidthForPopups > window.outerWidth) // the screen is too small for a popup\r\n                return false;\r\n            // if we're switching from https->http or from http->https don't use a popup\r\n            if (!window.document.location) return false;\r\n            if (!url.startsWith(\"http\") || !window.document.location.href.startsWith(\"http\"))\r\n                return false;\r\n            if ((url.startsWith(\"http://\") !== window.document.location.href.startsWith(\"http://\")) ||\r\n                (url.startsWith(\"https://\") !== window.document.location.href.startsWith(\"https://\")))\r\n                return false;\r\n            if (YVolatile.Basics.EditModeActive || YVolatile.Basics.PageControlVisible) {\r\n                //if we're in edit mode or the page control module is visible, all links bring up a page (no popups) except for modules with the PopupEdit style\r\n                if (elem.getAttribute(YConfigs.Basics.CssAttrDataSpecialEdit) == null)\r\n                    return false;\r\n            }\r\n\r\n            return this.openPopup(url, false);\r\n        }\r\n\r\n        /**\r\n         * Handles links in a popup that link to a url in the outer parent (main) window.\r\n         */\r\n        public handleOuterWindow(elem: HTMLAnchorElement): boolean {\r\n            // check if this is a popup link\r\n            if (!elem.getAttribute(YConfigs.Basics.CssOuterWindow))\r\n                return false;\r\n            if (!$YetaWF.isInPopup()) return false; // this shouldn't really happen\r\n            $YetaWF.setLoading(true);\r\n            if (!window.parent.$YetaWF.ContentHandling.setContent($YetaWF.parseUrl(elem.href), true))\r\n                window.parent.location.assign(elem.href);\r\n            return true;\r\n        }\r\n\r\n        public init(): void { }\r\n    }\r\n    // tslint:disable-next-line:no-unused-expression\r\n    $YetaWF.Popups; // need to evaluate for side effect to initialize popups\r\n}\r\n"]}